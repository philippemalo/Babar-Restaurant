---
import CustomScrollbar from "../components/CustomScrollbar.astro";
import Footer from "../components/Footer.astro";
import MobileNavbar from "../components/MobileNavbar.astro";
import Navbar from "../components/Navbar.astro";
import "../styles/global.css";
import MenuItem from "../components/MenuItem.astro";
import MenuContent from "../js/MenuContent";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <link rel="" type="" href="" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>Menu</title>
  </head>
  <body>
    <Navbar />
    <MobileNavbar />

    <div id="main-container">
      <div id="menu-img-container">
        <img id="deselect" src="/cancel_button.svg" />
      </div>

      <div id="menu-container">
        {
          MenuContent.map((menuItem, index) => (
            <MenuItem
              id={index}
              title={menuItem.title}
              description={menuItem.description}
              price={menuItem.price}
            />
          ))
        }
      </div>
    </div>

    <Footer />
    <CustomScrollbar />
  </body>
  <script type="module" defer>
    import MenuContent from "../src/js/MenuContent.ts";

    const mainContainer = document.querySelector("#main-container");
    const menuImgContainer = document.querySelector("#menu-img-container");
    const deselectButton = document.querySelector("#deselect");

    let selectedMenuItem = null;
    let menuContentItem = null;

    deselectButton.addEventListener("click", () => {
      selectedMenuItem.style.borderColor = "transparent";
      selectedMenuItem.style.backgroundColor = null;
      menuImgContainer.style.display = "none";
      selectedMenuItem = null;
      menuContentItem = null;
      let imgToRemove = document.getElementById("food-image");
      imgToRemove.remove();
    });

    const aspectRatioStyling = () => {
      let aspectRatio = window.innerWidth / window.innerHeight;

      if (aspectRatio < 1) {
        mainContainer.style.flexDirection = "column";
        mainContainer.style.alignItems = "center";
        menuImgContainer.style.width = "100%";
        menuImgContainer.style.maxHeight = "30vh";
        menuImgContainer.style.maxWidth = "500px";
        menuImgContainer.style.margin = "auto";
        // update image for portrait to landscape
        menuImgContainer.firstElementChild.src = menuContentItem.imageLandscape;
      } else {
        mainContainer.style.flexDirection = "row";
        menuImgContainer.style.width = "50%";
        menuImgContainer.style.maxWidth = "750px";
        menuImgContainer.style.maxHeight = "calc(100vh - 200px)";
        menuImgContainer.style.margin = "1rem";
        // update image for landscape to portrait
        menuImgContainer.firstElementChild.src = menuContentItem.imagePortrait;
      }
    };

    const menuItems = document.querySelectorAll(".menu-item");
    menuItems.forEach((item) => {
      item.addEventListener("click", () => {
        // If a menu item is already selected and the user selects another
        if (selectedMenuItem && item !== selectedMenuItem) {
          selectedMenuItem.style.borderColor = "transparent";
          selectedMenuItem.style.backgroundColor = null;
          let imgToRemove = document.getElementById("food-image");
          imgToRemove.remove();
        }

        // If the user selects a menu item that isn't already selected
        if (selectedMenuItem !== item) {
          selectedMenuItem = item;
          menuContentItem = MenuContent.find(
            (food) =>
              food.title ===
              item.firstElementChild.firstElementChild.textContent
          );

          item.style.borderColor = "black";
          selectedMenuItem.style.backgroundColor = "#F0BD3F";
          menuImgContainer.style.display = "block";

          let imgElement = document.createElement("img");
          imgElement.id = "food-image";
          imgElement.src =
            window.innerWidth / window.innerHeight > 1
              ? menuContentItem.imagePortrait
              : menuContentItem.imageLandscape;
          imgElement.style.width = "100%";
          imgElement.style.height = "100%";
          imgElement.style.objectFit = "cover";
          menuImgContainer.insertBefore(imgElement, deselectButton);
        }
        // If the user selects a menu item that is already selected
        else {
          selectedMenuItem = null;
          menuContentItem = null;
          item.style.borderColor = "transparent";
          item.style.backgroundColor = null;
          let imgToRemove = document.getElementById("food-image");
          imgToRemove.remove();
          menuImgContainer.style.display = "none";
        }

        aspectRatioStyling();
      });
    });

    addEventListener("resize", () => aspectRatioStyling());
  </script>
</html>

<style>
  #main-container {
    display: flex;
    width: 100%;
    justify-content: center;
    /* height: calc(100vh - 200px); */
  }
  #menu-container {
    display: flex;
    flex-direction: column;
    overflow-y: scroll;
    height: calc(100vh - 200px);
    margin: 1rem;
    padding: 1rem;
    border-radius: 5px;
    max-width: 500px;
    box-shadow: inset 0 0 10px #0000004f;
    transition: all 0.3s ease-in-out;
  }

  #menu-img-container {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 50%;
    max-width: 750px;
    overflow: hidden;
    margin: 1rem;
    height: calc(100vh - 200px);
    display: none;
    position: relative;
    border-radius: 5px;
  }
  #deselect {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 33px;
    height: 33px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
  }
  #deselect:hover {
    width: 36px;
    height: 36px;
  }
  @media screen and (max-width: 500px) {
    #menu-container {
      max-width: 90%;
    }
  }
  @media screen and (min-width: 501px) {
    #menu-container {
    }
  }
</style>
